## Stochastic model of Virginia

# Background
This directory contains a stochastic version of the Virginia model. 
Temoa uses the extensive formulation of stochastic optimization, programmed in Pyomo. For more information see:
	1) Background in Pyomo and instructions to run the example “farmer problem”: https://pyomo.readthedocs.io/en/stable/modeling_extensions/pysp.html#runef
	2) Additional background and full solution to the “farmer problem”: https://www.math.uh.edu/~rohop/Spring_15/Chapter1.pdf

# Modified model
Several modifications to the Virginia model were made to facilitate the computational intensity of a stochastic program:
	1) Reduced the number of seasons from 6 to 4
	2) Reduced the number of future time periods to 4

# Examples
A stochastic problem can have any number of uncertain variables. This directory contains two analyses each exploring the uncertainty of a different variable:
	1) uncertain_emission_limits - This analysis explores the impact of uncertain emission limit policies
	2) uncertain_technology_capital_costs - This analysis explores the impact of uncertain future technology capital costs i.e. will solar reduce in price 5% or 25% over the next 10 years.



Instructions to create the temoa-stoch-py2 environment and run the puerto_rico_stoch project
-

1) Creating python environment for temoa_stochastic
    0) Prerequisites: python 2.7 using Anaconda2
        - https://www.anaconda.com/distribution/#download-section
    2) Download temoatools
        - https://www.github.com/EnergyModels/temoatools
    2) Create temoa-stoch-py2 environment within anaconda 2
        - start anaconda
        - move to temoa_stochastic directory
        - create and activate environment using environment.yml
    3) Install modified version of Pyomo (Details of modifications are in pyomo_instructions.txt)
        - move to pyomo directory
        - install pyomo
    3) Install temoatools
        - move to temoatools directory
        - install temoatools

    Sample commands for running on Rivanna, UVA's high performance computing system*:
    
    >
        git clone https://www.github.com/EnergyModels/temoatools
        module load anaconda/2019.10-py2.7
        cd temoatools/temoa_stochastic
        conda env create
        source activate temoa-stoch-py2
        cd pyomo
        pip install .
        cd ../..
        pip install 

2) Running the project
    1) Option 1: Using shell scripts (recommended):
        - start terminal and move to temoatools/projects/va_stoch/uncertain_emission_limit directory
        - Run pre_processing.sh
        - Run run_all_simulations.sh (generated by pre_processing as an executable, each simulation takes ~12 hours)
        - Run post_processing.sh
    
    Sample commands for running on Rivanna*:
    
    >
        cd temoatools/projects/va_stoch/uncertain_emission_limit
        sbatch run_pre_processing.sh
        ./run_all_simulations.sh
        sbatch run_post_processing.sh